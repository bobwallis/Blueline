#!/bin/bash

dWhich=`which "$0"`
d=`dirname "$dWhich"`

# Execute RequireJS builder
"$d/helpers/requirejs/build/build.sh" app.build.js

# GZip compiled CSS and copy to styles.built
find "$d/../../www-build/" -type f -name "*.css" -print | parallel -j +0 "gzip -9c {} > {}.gz"
rm -rf "$d/../../www/styles.built"
mv "$d/../../www-build/styles" "$d/../../www/styles.built"

# GZip compressed JS and copy to scripts.built
find "$d/../../www-build/" -type f -name "*.js" -print | parallel -j +0 "gzip -9c {} > {}.gz"
rm -rf "$d/../../www/scripts.built"
mv "$d/../../www-build/scripts" "$d/../../www/scripts.built"


# Remove www-build directory
rm -rf "$d/../../www-build"